## Запускаем окружение

```shell
docker-compose -f hw11.docker-compose.yml up -d --build --force-recreate
docker-compose -f hw11.docker-compose.yml down -v
docker-compose -f hw11.docker-compose.yml down -v zabbix-db
docker volume rm zabbix-db-data
```

Data Source
http://prometheus:9090/

# Prometheus business metrics RED

Open Grafana http://localhost:3000/
login: admin
password: !QAZ2wsx

# Zabbix technical metrics

Open Zabbix Web http://localhost:9091/
Login: Admin
Password: zabbix

Установка плагина в графане для Zabbix
docker exec -it grafana grafana-cli plugins install alexanderzobnin-zabbix-app
docker-compose -f hw11.docker-compose.yml up -d --build --force-recreate grafana

Зайти в Plugins Grafana http://localhost:3000/plugins
Сделать Zabbix Enable

Добавить Data Sources - Zabbix
URL: http://zabbix-web:8080/api_jsonrpc.php
User: Admin
Password: zabbix
Включить Use trends
Cache TTL: 1m

Добавить Dashboards - Zabbix
В Dashboards открыть Import
Ввести ID 5363 и нажать Load


Найти в конфигах строки
docker exec -it zabbix-server grep -Ri 'MYSQL_DATABASE' /etc/zabbix/
docker exec -it zabbix-server grep -Ri 'ZBX_DB_HOST' /etc/zabbix/


Подключение к бд Zabbix
docker exec -it zabbix-db mysql -u admin -p
Ввести пароль: !QAZ2wsx
mysql> USE zabbix;
mysql> SHOW TABLES;
mysql> SELECT * FROM users;

1. Загружаем схему вручную из MySQL-контейнера
   
Зайти в контейнер базы данных zabbix-db:
docker exec -it zabbix-db bash

Проверить что файл create.sql.gz существует:
find / -name "create.sql.gz"

Если файл найден (например, /usr/share/doc/zabbix-server-mysql/create.sql.gz), выполнить команду:
zcat /usr/share/doc/zabbix-server-mysql/create.sql.gz | mysql -u admin -p zabbix
Пароль !QAZ2wsx

SET FOREIGN_KEY_CHECKS=0;

INSERT INTO users (userid, username, name, surname, passwd, url, autologin, autologout, lang, theme, refresh, roleid, userdirectoryid, attempt_failed, attempt_ip, attempt_clock, rows_per_page, timezone, ts_provisioned)
VALUES (1, 'Admin', 'Zabbix', 'Administrator', MD5('zabbix'), '', 1, '15m', 'en_GB', 'default', '30s', 1, NULL, 0, '', 0, 50, 'default', 0);

SET FOREIGN_KEY_CHECKS=1;
